<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>starcat References</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>
    
    <script data-goatcounter="https://slowkow.goatcounter.com/count"
              async src="//gc.zgo.at/count.js"></script>
    <style>
    .table, .table th, .table td {
        border: 1px solid #dee2e6;
        text-align: center;
    }
    </style>
        
  </head>
  <body>
		<nav class="navbar navbar-expand-lg bg-light">
			<div class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
				<a class="navbar-brand" href="index.html"><span class="me-2"><img class="" height="60px" src="https://github.com/user-attachments/assets/bbb3286e-e79a-496f-9879-fe9c9ee560ed"></img></span>starCAT</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
					<div class="navbar-nav">
                        <a class="nav-link" href="references.html">References</a>
                        <a class="nav-link" href="https://github.com/immunogenomics/starcat">GitHub</a>
                        <a class="nav-link" href="https://www.biorxiv.org/content/10.1101/2024.05.03.592310v1">BioRxiv</a>
					</div>
				</div>
			</div>
		</nav>

    <div class="container mt-3">
        <p class="lead">Available references for use with starCAT. If you use one of these references in your own work, please cite the corresponding paper as well as the <a href="https://www.biorxiv.org/content/10.1101/2024.05.03.592310v1">starCAT paper</a>.</p>
        <div class="mt-4">
            <pre class="bg-light" style="white-space: pre-wrap;" id="output"></pre>
        </div>    
       <div class="table-responsive">
            <table id="references-table" class="table table-striped table-hover"></table>
        </div>
    </div>

    <script type="text/javascript">

        // Fetch the TSV data
        async function fetchTSV() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/immunogenomics/starCAT/main/src/starcat/current_references.tsv');
                const tsvData = await response.text();
                parseTSV(tsvData);
            } catch (error) {
                console.error("Error fetching the TSV file:", error);
            }
        }

        // Parse the TSV into an array of objects
        function parseTSV(tsvData) {
            // Trim, filter double quotations, split lines
            const rows = tsvData.trim().replace(/"/g, '').split('\n');

            // Skip rows that start with '#' (comments)
            const dataRows = rows.filter(row => !row.startsWith('#'));

            const headers = dataRows[0].trim().split('\t');
            console.log(headers)

            // Parse each row into an object with keys as headers
            const data = dataRows.slice(1).map(row => {
                const values = row.split('\t');
                return headers.reduce((obj, header, i) => {
                    obj[header] = values[i];
                    return obj;
                }, {});
            });

            // Manipulate the data as per the Python script
            processTableData(data);
        }

        // Process the data (add download links and description)
        function processTableData(data) {
            const table = document.getElementById('references-table');
            
            // Define the columns you want to display
            const cols = ['Name', 'Cell_Type', 'Tissue', 'Species', 'Contexts', 'Description', 'Download'];

            // Create table headers
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            cols.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Create table body
            const tbody = document.createElement('tbody');

            data.forEach(row => {
                // Create download and description links
                const downloadLink = `<a href="${row['Link']}">Download</a>`;
                const publink = `<a href="${row['Publication_Link']}">publication</a>`;
                row['Description'] = row['Description'].replace('publication', publink);
                const zenodolink = `<a href="${row['Link']}">${row['Name']}</a>`;
                row['Name'] = zenodolink;
                row['Download'] = downloadLink;

                // Create table row
                const tr = document.createElement('tr');
                cols.forEach(col => {
                    const td = document.createElement('td');
                    td.innerHTML = row[col] || ''; // Use innerHTML to allow HTML content
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
        }

        // Start fetching and building the table on page load
        fetchTSV();

    </script>

</body>
</html>
